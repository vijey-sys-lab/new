<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Devverse — Multi-day Video Player (validated)</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><circle cx='64' cy='64' r='64' fill='%2300b894'/><text x='64' y='78' font-size='64' font-family='Arial' font-weight='700' text-anchor='middle' fill='white'>D</text></svg>">

<style>
  :root{
    --bg:#f3f7fb; --card:#fff; --accent:#00b894; --muted:#667085; --danger:#b00020;
    --shadow: 0 8px 30px rgba(13,38,59,0.06);
  }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);margin:0;color:#0b1220}
  .wrap{max-width:980px;margin:28px auto;padding:20px;background:var(--card);border-radius:12px;box-shadow:var(--shadow)}
  header{display:flex;gap:12px;align-items:center}
  h1{margin:0;font-size:18px}
  .muted{color:var(--muted);font-size:13px}

  .row{display:flex;gap:12px;align-items:center;margin-top:12px}
  input,select,button,textarea{font-size:14px;padding:10px;border-radius:8px;border:1px solid #e6edf5;background:#fff}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  .btn.secondary{background:#f1f5f9;color:#0b1220;border:1px solid #e6edf5}
  .player-wrap{margin-top:18px;border-radius:12px;overflow:hidden;background:#000;position:relative}
  .video-stage{position:relative;background:#000;max-height:720px;display:flex;justify-content:center;align-items:center}
  video{width:100%;height:auto;display:block;background:#000;outline:none}
  .tokenBox{margin-top:12px;padding:12px;border-radius:8px;background:#ecfdf5;border:1px solid #c6f6d5}
  .error{margin-top:10px;color:var(--danger)}
  .info{margin-top:12px;color:var(--muted);font-size:13px}
  @media (max-width:880px){ .wrap{margin:12px;padding:12px} .row{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <svg viewBox="0 0 48 48" width="44" height="44" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#00b894"/><stop offset="1" stop-color="#0077ff"/></linearGradient></defs><rect width="48" height="48" rx="10" fill="url(#g)"/><text x="24" y="30" font-size="20" font-family="Segoe UI, Arial" font-weight="700" fill="#fff" text-anchor="middle">D</text></svg>
      <div>
        <h1>Devverse — RECORDED CLASS (validated)</h1>
        <div class="muted">You must enter name & email before playback — controls unlock once validated.</div>
      </div>
    </header>

    <div class="row" style="margin-top:14px">
      <div style="flex:1">
        <label class="muted">Full name</label><br>
        <input id="name" placeholder="Your full name" />
      </div>

      <div style="width:320px">
        <label class="muted">Email</label><br>
        <input id="email" placeholder="you@gmail.com" />
      </div>
    </div>

    <div class="row">
      <div>
        <label class="muted">Select Day</label><br>
        <select id="daySelect"></select>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="playBtn" class="btn">Play</button>
        <button id="pauseBtn" class="btn secondary">Pause</button>
        <button id="fsBtn" class="btn secondary">⤢ Fullscreen</button>
      </div>
    </div>

    <div id="error" class="error" role="status" aria-live="polite"></div>

    <div class="player-wrap" id="playerWrap" style="margin-top:14px">
      <div class="video-stage">
        <!-- controls are initially DISABLED to prevent playing before validation -->
        <video id="video" playsinline preload="metadata"></video>
      </div>
    </div>

    <div id="tokenArea"></div>

    <div class="info"> AFTER TOKEN GENTERATED KINDLY SEND SCREENSHORT TO devversecare@gmail.com</div>
  </div>

<script>
/* ---------------- CONFIGURATION ---------------- */
const DAY_COUNT = 20;
const ARCHIVE_URLS = {
  1: "https://ia801703.us.archive.org/30/items/meet-devverse/Meet%20%E2%80%93%20DEVVERSE.mp4",
  2: "https://ia801700.us.archive.org/19/items/meet-devverse_202512/Meet%20%E2%80%93%20DEVVERSE.mp4",
  3: "https://ia601702.us.archive.org/16/items/meet-devverse_20251210/Meet%20%E2%80%93%20DEVVERSE.mp4",4:"https://ia801701.us.archive.org/13/items/meet-devverse_20251215/Meet%20%E2%80%93%20DEVVERSE.mp4",
  5:"https://ia801708.us.archive.org/3/items/meet-devverse-1/Meet%20%E2%80%93%20DEVVERSE%20%281%29.mp4",
  6:"https://ia801701.us.archive.org/8/items/meet-devverse-2/Meet%20%E2%80%93%20DEVVERSE%20%282%29.mp4",
  7:"https://ia601707.us.archive.org/18/items/meet-devverse_20251220/Meet%20%E2%80%93%20DEVVERSE.mp4",8:"",9:"",10:"",11:"",12:"",13:"",14:"",15:"",16:"",17:"",18:"",19:"",20:""
};
/* ---------------- END CONFIG ------------------ */

/* DOM refs */
const nameInput = document.getElementById('name');
const emailInput = document.getElementById('email');
const daySelect = document.getElementById('daySelect');
const video = document.getElementById('video');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const fsBtn = document.getElementById('fsBtn');
const errorEl = document.getElementById('error');
const tokenArea = document.getElementById('tokenArea');

let currentDay = null;
let playStartTime = null;
let heartbeatTimer = null;

/* helpers */
function showError(msg){ errorEl.textContent = msg || ''; }
function clearError(){ errorEl.textContent = ''; }
function isValidUser(){
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  return name && /^\S+@\S+\.\S+$/.test(email);
}
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* populate day dropdown */
for(let i=1;i<=DAY_COUNT;i++){
  const opt = document.createElement('option'); opt.value = i; opt.textContent = 'Day ' + i; daySelect.appendChild(opt);
}
daySelect.value = 1;

/* ensure controls locked initially */
video.controls = false;

/* helper to get URL for day */
function getUrlForDay(d){
  d = Number(d);
  if(ARCHIVE_URLS[d] && ARCHIVE_URLS[d].trim()) return ARCHIVE_URLS[d].trim();
  return null;
}

/* prepare/load day source (but do not enable controls until validated) */
async function ensureDayLoaded(day){
  const url = getUrlForDay(day);
  if(!url){
    showError('No video configured for Day ' + day + '. Add URL to ARCHIVE_URLS in the file.');
    return false;
  }
  const current = video.currentSrc || video.src || '';
  if(current && (current === url || current.indexOf(url) !== -1)) return true;
  video.pause();
  video.src = url;
  try{ await video.load(); }catch(e){}
  currentDay = day;
  playStartTime = null;
  tokenArea.innerHTML = '';
  // keep controls disabled until validation
  video.controls = false;
  clearError();
  return true;
}

/* Play handler: validates user, then plays and unlocks controls */
async function playAction(){
  clearError();
  if(!isValidUser()){
    showError('Enter a valid name and email before playing.');
    return;
  }

  const day = Number(daySelect.value);
  const ok = await ensureDayLoaded(day);
  if(!ok) return;

  try{
    await video.play();
    // only enable native controls AFTER user validated and playback started
    video.controls = true;

    // playStartTime will be set via 'playing' event (reliable)
    startHeartbeat();
  }catch(err){
    showError('Playback blocked: ' + (err && err.message ? err.message : 'unknown'));
  }
}

/* Pause handler */
function pauseAction(){
  video.pause();
  stopHeartbeat();
}

/* Fullscreen */
async function toggleFullscreen(){
  try{
    if(document.fullscreenElement) await document.exitFullscreen();
    else await document.getElementById('playerWrap').requestFullscreen();
  }catch(e){}
}

/* Defensive: if play is triggered any other way (keyboard/devtools), pause if user not valid.
   This ensures video cannot run unless validation passed. */
video.addEventListener('play', (e)=>{
  if(!isValidUser()){
    // stop playback immediately
    try{ video.pause(); } catch(e){}
    showError('Enter a valid name and email before playing.');
    // keep controls disabled
    video.controls = false;
  }
});

/* Record actual playback start when frames begin showing */
video.addEventListener('playing', ()=>{
  if(!playStartTime) playStartTime = new Date().toISOString();
});

/* Video ended: generate token with start & end times */
video.addEventListener('ended', ()=>{
  stopHeartbeat();

  const endISO = new Date().toISOString();
  const endDisplay = new Date(endISO).toLocaleString();
  if(!playStartTime) playStartTime = endISO; // fallback
  const startDisplay = new Date(playStartTime).toLocaleString();

  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const day = Number(daySelect.value);
  const now = new Date();
  const token = `DEVV-${now.getTime().toString(36).toUpperCase().slice(-10)}`;

  const info = { token, name, email, day, startTimeISO: playStartTime, endTimeISO: endISO, startDisplay, endDisplay, savedAt: now.toISOString() };

  // save locally
  try{
    const arr = JSON.parse(localStorage.getItem('devv_tokens_v1') || '[]');
    arr.push(info);
    localStorage.setItem('devv_tokens_v1', JSON.stringify(arr));
  }catch(e){ console.warn('token save failed', e); }

  tokenArea.innerHTML = `
    <div class="tokenBox" role="status" aria-live="polite">
      <strong>Completion Token</strong><br>
      Name: ${escapeHtml(info.name)}<br>
      Email: ${escapeHtml(info.email)}<br>
      Day: ${info.day}<br>
      Token: <b>${info.token}</b><br>
      Started: ${escapeHtml(info.startDisplay)}<br>
      Ended: ${escapeHtml(info.endDisplay)}<br>
      <div style="margin-top:8px">
        <button class="btn secondary" id="copyTokenBtn">Copy Token</button>
        <button class="btn" id="downloadTokenBtn">Download</button>
      </div>
    </div>
  `;
  document.getElementById('copyTokenBtn').addEventListener('click', ()=> navigator.clipboard.writeText(info.token).then(()=> alert('Token copied')));
  document.getElementById('downloadTokenBtn').addEventListener('click', ()=> {
    const txt = `Name: ${info.name}\nEmail: ${info.email}\nDay: ${info.day}\nToken: ${info.token}\nStarted: ${info.startDisplay}\nEnded: ${info.endDisplay}\nSaved At: ${new Date(info.savedAt).toLocaleString()}\n`;
    const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([txt], {type:'text/plain'})); a.download = `token_${info.token}.txt`; a.click(); URL.revokeObjectURL(a.href);
  });

  // reset
  playStartTime = null;
  // keep controls enabled for review after end (optional) — do not disable
});

/* Heartbeat */
function startHeartbeat(){
  stopHeartbeat();
  heartbeatTimer = setInterval(()=>{
    try{
      const arr = JSON.parse(localStorage.getItem('devv_progress_v1') || '[]');
      arr.push({ name: nameInput.value.trim(), email: emailInput.value.trim(), day: Number(daySelect.value), currentTime: video.currentTime, duration: isFinite(video.duration) ? video.duration : null, ts: new Date().toISOString() });
      localStorage.setItem('devv_progress_v1', JSON.stringify(arr));
    }catch(e){}
  }, 7000);
}
function stopHeartbeat(){ if(heartbeatTimer){ clearInterval(heartbeatTimer); heartbeatTimer = null; } }

/* Initial load: set day1 src if present; controls remain disabled until validation */
(async function init(){
  // ensure dropdown filled
  if(daySelect.options.length === 0){
    for(let i=1;i<=DAY_COUNT;i++){ const o=document.createElement('option'); o.value=i; o.textContent='Day ' + i; daySelect.appendChild(o); }
    daySelect.value = 1;
  }
  const initial = Number(daySelect.value);
  const url = getUrlForDay(initial);
  if(url){
    video.src = url;
    try{ await video.load(); }catch(e){}
    currentDay = initial;
  }
})();

/* handlers */
playBtn.addEventListener('click', playAction);
pauseBtn.addEventListener('click', pauseAction);
fsBtn.addEventListener('click', toggleFullscreen);

/* day switch: disable controls + reset state */
daySelect.addEventListener('change', async ()=>{
  clearError();
  const d = Number(daySelect.value);
  const url = getUrlForDay(d);
  if(!url){
    showError('No video configured for Day ' + d + '. Add URL to ARCHIVE_URLS in this file.');
    video.removeAttribute('src'); video.load();
    currentDay = null; playStartTime = null; tokenArea.innerHTML = '';
    video.controls = false;
    return;
  }
  const current = video.currentSrc || video.src || '';
  if(!(current && (current === url || current.indexOf(url) !== -1))){
    video.pause();
    video.src = url;
    try{ await video.load(); }catch(e){}
    currentDay = d; playStartTime = null; tokenArea.innerHTML = ''; video.controls = false;
  }
});

/* error handling */
video.addEventListener('error', ()=> showError('Error loading video. Confirm the day link is a direct MP4 URL and publicly accessible.'));

/* clear errors when the user starts typing */
nameInput.addEventListener('input', clearError);
emailInput.addEventListener('input', clearError);

/* helper */
function getUrlForDay(d){ d = Number(d); if(ARCHIVE_URLS[d] && ARCHIVE_URLS[d].trim()) return ARCHIVE_URLS[d].trim(); return null; }
</script>
</body>
</html>




